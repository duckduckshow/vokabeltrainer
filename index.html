<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vokabeltrainer – Quiz (minimal) + Zusatzinfo</title>
<style>
  * { box-sizing: border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
  body { margin:0; background:#f4f4f4; display:flex; justify-content:center; }
  .app{
    background:#fff; max-width: 920px; width:100%;
    margin:12px; padding:12px; border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,0.10);
  }
  h1{ text-align:center; font-size:18px; margin:6px 0 10px; }
  .topbar{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
  .score{ font-size:12px; color:#555; }
  .modeRow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  select, button, input{
    border-radius:8px; border:1px solid #ccc; padding:8px 10px; font-size:13px;
  }
  button{ border:none; background:#007bff; color:#fff; cursor:pointer; }
  button:hover{ background:#0062cc; }
  button.secondary{ background:#222; }
  button.secondary:hover{ background:#000; }
  button.ghost{ background:#e9ecef; color:#111; border:1px solid #d0d7de; }
  button.ghost:hover{ background:#dde3ea; }

  .card{
    margin-top:10px;
    border:1px solid #e6e6e6; border-radius:10px; padding:12px;
    background:#fafafa;
  }
  .meta{ font-weight:700; font-size:12px; color:#444; margin-bottom:6px; }
  .question{ font-weight:700; margin-bottom:8px; }
  .prompt{
    padding:10px; background:#fff; border:1px solid #e6e6e6; border-radius:10px;
    font-size:16px; font-weight:800;
  }

  .answers{ display:grid; gap:8px; margin-top:10px; }
  .answer{
    border:1px solid #ccc; border-radius:10px;
    padding:10px; background:#fff; cursor:pointer;
  }
  .answer:hover{ background:#f2f2f2; }
  .answer.correct{ background:#d4edda; border-color:#28a745; }
  .answer.wrong{ background:#f8d7da; border-color:#dc3545; }
  .answer.disabled{ pointer-events:none; opacity:0.98; }

  .typeRow{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
  .typeRow input{ flex:1; min-width:220px; }

  .feedback{ margin-top:10px; font-weight:900; min-height:20px; }
  .afterRow{ margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  .miniResult{
    font-size:13px; color:#222; font-weight:700;
    background:#fff; border:1px solid #e6e6e6; border-radius:10px;
    padding:8px 10px;
  }

  /* Luxus-Zusatzinfo (ausklappbar) */
  .extra{
    display:none;
    margin-top:10px;
    padding:10px;
    background:#fff7e6;
    border:1px solid #ffe1a6;
    border-left:4px solid #ffb000;
    border-radius:10px;
    font-size:12px; color:#333;
    line-height:1.35;
  }
  .extra .head{ font-weight:900; margin-bottom:6px; }
  .extra .label{ font-weight:800; }
  .extra .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

  .controls{ margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
  .progress{ font-size:12px; color:#555; }
</style>
</head>
<body>
<div class="app">
  <h1>Vokabeltrainer – Quiz (minimal) + Zusatzinfo</h1>

  <div class="topbar">
    <div class="modeRow">
      <label for="mode" style="font-size:12px;color:#444;font-weight:800;">Modus:</label>
      <select id="mode" onchange="restart(true)">
        <option value="mc_en_de">Multiple Choice: EN → DE</option>
        <option value="mc_de_en">Multiple Choice: DE → EN</option>
        <option value="type_en_de">Tippen: EN → DE</option>
        <option value="type_de_en">Tippen: DE → EN</option>
        <option value="mixed">Gemischt (alles)</option>
      </select>

      <button class="ghost" onclick="toggleShuffle()" id="shuffleBtn">Reihenfolge: Zufall</button>
    </div>

    <div class="score" id="score">Punkte: 0</div>
  </div>

  <div class="card">
    <div class="meta" id="meta"></div>
    <div class="question" id="question"></div>
    <div class="prompt" id="prompt"></div>

    <div id="mcArea" style="display:none;">
      <div class="answers" id="answers"></div>
    </div>

    <div id="typeArea" style="display:none;">
      <div class="typeRow">
        <input id="typeInput" type="text" placeholder="Antwort eintippen …" onkeydown="onTypeKey(event)" />
        <button onclick="submitTyping()">Prüfen</button>
      </div>
    </div>

    <div class="feedback" id="feedback"></div>

    <!-- Minimal: zeigt nach Antwort nur Primär -->
    <div class="afterRow" id="afterRow" style="display:none;">
      <div class="miniResult" id="miniResult"></div>
      <button class="ghost" id="extraBtn" onclick="toggleExtra()">Zusatzinfo anzeigen</button>
    </div>

    <!-- Luxus: klappt per Button aus -->
    <div class="extra" id="extra"></div>

    <div class="controls">
      <div class="progress" id="progress"></div>
      <div style="display:flex; gap:8px;">
        <button class="secondary" onclick="restart()">Neu starten</button>
        <button onclick="next()">Nächste Aufgabe</button>
      </div>
    </div>
  </div>
</div>

<script>
/*
Didaktik:
- Quizansicht minimal (nur Aufgabe + Antwort)
- Nach Antwort: nur Primärlösung (prüfungsrelevant)
- Button: Zusatzinfo (Nebenbedeutungen + Wortverbindung + Beispielsatz)
*/

const VOCAB = [
  { en:"a culprit", primary:"der Täter / die Täterin", secondary:["schuldige Person"], collocation:"", ex_en:"The police found the culprit.", ex_de:"Die Polizei fand den Täter." },
  { en:"an account", primary:"ein Konto / ein Account", secondary:["Benutzerkonto"], collocation:"", ex_en:"I created a new account online.", ex_de:"Ich habe online ein neues Konto erstellt." },
  { en:"a batch-job run", primary:"Stapelverarbeitungslauf", secondary:[], collocation:"", ex_en:"The computer started a batch-job run at night.", ex_de:"Der Computer startete nachts einen Stapelverarbeitungslauf." },
  { en:"dandruff", primary:"Schuppen", secondary:[], collocation:"", ex_en:"He has dandruff on his jacket.", ex_de:"Er hat Schuppen auf seiner Jacke." },
  { en:"facetious", primary:"scherzhaft, flapsig", secondary:["nicht ganz ernst gemeint"], collocation:"", ex_en:"She made a facetious comment.", ex_de:"Sie machte eine scherzhafte Bemerkung." },
  { en:"home truths", primary:"unangenehme Wahrheiten", secondary:[], collocation:"", ex_en:"He told me some home truths.", ex_de:"Er sagte mir ein paar unangenehme Wahrheiten." },
  { en:"ICT", primary:"IKT (Informations- und Kommunikationstechnologie)", secondary:[], collocation:"", ex_en:"We learn about ICT at school.", ex_de:"Wir lernen in der Schule etwas über IKT." },
  { en:"ingenuity", primary:"Einfallsreichtum", secondary:["Kreativität"], collocation:"", ex_en:"She solved the problem with great ingenuity.", ex_de:"Sie löste das Problem mit großem Einfallsreichtum." },
  { en:"innocent until proven guilty", primary:"Es gilt die Unschuldsvermutung.", secondary:[], collocation:"", ex_en:"In court, you are innocent until proven guilty.", ex_de:"Vor Gericht gilt die Unschuldsvermutung." },
  { en:"jabberwocky", primary:"Kauderwelsch, Nonsenssprache", secondary:[], collocation:"", ex_en:"The baby spoke in jabberwocky.", ex_de:"Das Baby sprach Kauderwelsch." },
  { en:"subtle", primary:"subtil, feinsinnig", secondary:["kaum bemerkbar"], collocation:"", ex_en:"There was a subtle change in his voice.", ex_de:"Es gab eine subtile Veränderung in seiner Stimme." },

  { en:"to access", primary:"zugreifen", secondary:["auf etwas zugreifen"], collocation:"access something", ex_en:"You can access the file online.", ex_de:"Du kannst online auf die Datei zugreifen." },
  { en:"to accuse", primary:"beschuldigen", secondary:["anklagen"], collocation:"accuse someone of something", ex_en:"She accused him of cheating.", ex_de:"Sie beschuldigte ihn des Schummelns." },
  { en:"to be released on bail", primary:"gegen Kaution freigelassen werden", secondary:[], collocation:"released on bail", ex_en:"He was released on bail yesterday.", ex_de:"Er wurde gestern gegen Kaution freigelassen." },
  { en:"to boast", primary:"angeben", secondary:["prahlen"], collocation:"boast about something", ex_en:"He boasted about his new bike.", ex_de:"Er prahlte mit seinem neuen Fahrrad." },
  { en:"to challenge", primary:"herausfordern", secondary:[], collocation:"challenge someone to something", ex_en:"She challenged her friend to a game.", ex_de:"Sie forderte ihre Freundin zu einem Spiel heraus." },
  { en:"to confront", primary:"entgegentreten / konfrontieren", secondary:["sich stellen"], collocation:"confront someone / confront something", ex_en:"He confronted his fears.", ex_de:"Er stellte sich seinen Ängsten." },
  { en:"to cope with", primary:"mit etwas zurechtkommen", secondary:["bewältigen"], collocation:"cope with something", ex_en:"She copes well with stress.", ex_de:"Sie kommt gut mit Stress zurecht." },
  { en:"to escape", primary:"entkommen", secondary:["fliehen"], collocation:"escape from something", ex_en:"The prisoner escaped from prison.", ex_de:"Der Gefangene entkam aus dem Gefängnis." },
  { en:"to glare at", primary:"jemanden böse anschauen", secondary:["anblitzen"], collocation:"glare at someone", ex_en:"She glared at him angrily.", ex_de:"Sie schaute ihn wütend an." },
  { en:"to hack into", primary:"hacken, knacken", secondary:["unerlaubt eindringen"], collocation:"hack into something", ex_en:"Someone hacked into my account.", ex_de:"Jemand hat mein Konto gehackt." },

  // Hinweis: "to leak my eyes" ist unüblich; ich halte die Prüfungsbedeutung aber fix.
  { en:"to leak my eyes", primary:"weinen", secondary:["Tränen vergießen"], collocation:"(rare) leak my eyes", ex_en:"She started to leak her eyes.", ex_de:"Sie begann zu weinen." },

  { en:"to own up", primary:"(sich) etwas eingestehen", secondary:["zugeben"], collocation:"own up to something", ex_en:"He owned up to his mistake.", ex_de:"Er gab seinen Fehler zu." },
  { en:"to struggle with", primary:"mit etwas kämpfen", secondary:["Schwierigkeiten haben mit","sich abmühen mit"], collocation:"struggle with something", ex_en:"He struggles with English grammar.", ex_de:"Er hat Schwierigkeiten mit der englischen Grammatik." },
];

/* ===== State ===== */
let idx = 0;
let score = 0;
let done = false;
let shuffle = true;
let order = [];

let current = null;             // {v, mode, expectedPrimary, promptText, answerText}
let currentCorrectIdx = 0;

const modeEl = document.getElementById("mode");
const scoreEl = document.getElementById("score");
const metaEl = document.getElementById("meta");
const questionEl = document.getElementById("question");
const promptEl = document.getElementById("prompt");

const mcArea = document.getElementById("mcArea");
const answersEl = document.getElementById("answers");

const typeArea = document.getElementById("typeArea");
const typeInput = document.getElementById("typeInput");

const feedbackEl = document.getElementById("feedback");
const progressEl = document.getElementById("progress");

const afterRow = document.getElementById("afterRow");
const miniResult = document.getElementById("miniResult");
const extraBtn = document.getElementById("extraBtn");
const extraEl = document.getElementById("extra");

const shuffleBtn = document.getElementById("shuffleBtn");

/* ===== Helpers ===== */
function randInt(n){ return Math.floor(Math.random()*n); }

function shuffledIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = randInt(i+1);
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

function normalize(s){
  return (s ?? "")
    .toString()
    .trim()
    .toLowerCase()
    .replace(/\s+/g," ")
    .replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss");
}

function pick3Wrong(correctIndex, wantPrimaryDE){
  const pool = [];
  for(let i=0;i<VOCAB.length;i++) if(i !== correctIndex) pool.push(i);

  const picks = [];
  while(picks.length < 3 && pool.length){
    const j = randInt(pool.length);
    picks.push(pool[j]);
    pool.splice(j,1);
  }

  return picks.map(i => wantPrimaryDE ? VOCAB[i].primary : VOCAB[i].en);
}

function setExtraVisible(visible){
  extraEl.style.display = visible ? "block" : "none";
  extraBtn.textContent = visible ? "Zusatzinfo verbergen" : "Zusatzinfo anzeigen";
}

function buildExtra(v){
  const sec = (v.secondary && v.secondary.length) ? v.secondary.map(x=>`• ${x}`).join("<br>") : "–";
  const coll = v.collocation ? `<span class="mono">${escapeHtml(v.collocation)}</span>` : "–";
  const exEn = v.ex_en ? escapeHtml(v.ex_en) : "–";
  const exDe = v.ex_de ? escapeHtml(v.ex_de) : "–";

  return `
    <div class="head">Zusatzinfo</div>
    <div><span class="label">Primär (Quiz):</span> ${escapeHtml(v.primary)}</div>
    <div style="margin-top:6px;"><span class="label">Nebenbedeutungen:</span><br>${sec}</div>
    <div style="margin-top:6px;"><span class="label">Wortverbindung:</span> ${coll}</div>
    <div style="margin-top:6px;"><span class="label">Beispiel:</span><br>
      <span class="mono">${exEn}</span><br>
      ${exDe}
    </div>
  `;
}

function escapeHtml(str){
  return (str ?? "").toString()
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}

/* ===== Round ===== */
function buildRound(){
  const vocabIndex = order[idx];
  const v = VOCAB[vocabIndex];

  let mode = modeEl.value;
  if(mode === "mixed"){
    const modes = ["mc_en_de","mc_de_en","type_en_de","type_de_en"];
    mode = modes[randInt(modes.length)];
  }

  current = { v, vocabIndex, mode };

  done = false;
  feedbackEl.textContent = "";
  afterRow.style.display = "none";
  miniResult.textContent = "";
  extraEl.innerHTML = "";
  setExtraVisible(false);

  metaEl.textContent = `Wortschatz: ${VOCAB.length} Wörter`;
  progressEl.textContent = `Aufgabe ${idx+1} von ${VOCAB.length}`;

  if(mode.startsWith("mc")){
    mcArea.style.display = "block";
    typeArea.style.display = "none";
    renderMC(mode, v, vocabIndex);
  } else {
    mcArea.style.display = "none";
    typeArea.style.display = "block";
    renderTyping(mode, v);
  }
}

function renderMC(mode, v, vocabIndex){
  answersEl.innerHTML = "";

  const askEN = (mode === "mc_en_de"); // prompt EN, choose DE
  questionEl.textContent = askEN ? "Wähle die richtige Bedeutung:" : "Wähle das richtige englische Wort:";
  promptEl.textContent = askEN ? v.en : v.primary;

  const correct = askEN ? v.primary : v.en;
  const wrongs = pick3Wrong(vocabIndex, askEN);

  const options = [correct, ...wrongs];
  const optOrder = shuffledIndices(4);
  currentCorrectIdx = optOrder.indexOf(0);

  optOrder.forEach((origIdx, shownIdx) => {
    const b = document.createElement("div");
    b.className = "answer";
    b.textContent = options[origIdx];
    b.onclick = () => answerMC(shownIdx, b);
    answersEl.appendChild(b);
  });

  // für Anzeige nachher:
  current.expectedPrimary = askEN ? v.primary : v.en;
}

function answerMC(chosenIdx, chosenBtn){
  if(done) return;
  done = true;

  [...answersEl.children].forEach((el, j) => {
    el.classList.add("disabled");
    if(j === currentCorrectIdx) el.classList.add("correct");
  });

  const ok = (chosenIdx === currentCorrectIdx);
  if(ok){
    score++;
    scoreEl.textContent = "Punkte: " + score;
    feedbackEl.textContent = "Richtig!";
  } else {
    chosenBtn.classList.add("wrong");
    feedbackEl.textContent = "Falsch.";
  }

  showMinimalResult();
}

function renderTyping(mode, v){
  const askEN = (mode === "type_en_de"); // prompt EN, type DE primary
  questionEl.textContent = askEN ? "Tippe die Bedeutung (Primär):" : "Tippe das englische Wort:";
  promptEl.textContent = askEN ? v.en : v.primary;

  typeInput.value = "";
  typeInput.focus();

  current.expectedPrimary = askEN ? v.primary : v.en;
}

function submitTyping(){
  if(done) return;
  done = true;

  const user = normalize(typeInput.value);
  const expected = normalize(current.expectedPrimary);

  // Tipp: primär kann Varianten mit / enthalten → akzeptiere jede Variante als korrekt
  const variants = current.expectedPrimary
    .split("/")
    .map(x => normalize(x))
    .map(x => x.replace(/^\s*der\s+|^\s*die\s+|^\s*das\s+/,"")) // kleine Toleranz bei Artikeln in Varianten
    .filter(Boolean);

  const userNorm = user.replace(/^\s*der\s+|^\s*die\s+|^\s*das\s+/,"");
  const ok = (userNorm === expected) || variants.includes(userNorm);

  if(ok){
    score++;
    scoreEl.textContent = "Punkte: " + score;
    feedbackEl.textContent = "Richtig!";
  } else {
    feedbackEl.textContent = "Falsch.";
  }

  showMinimalResult();
}

function onTypeKey(e){
  if(e.key === "Enter") submitTyping();
}

/* ===== After answer UI ===== */
function showMinimalResult(){
  const v = current.v;
  afterRow.style.display = "flex";

  // Minimal: nur die primäre Zuordnung zeigen
  // EN->DE oder DE->EN je nach Mode
  const mode = current.mode;
  if(mode === "mc_en_de" || mode === "type_en_de" || (mode === "mixed" && promptEl.textContent === v.en)){
    miniResult.textContent = `${v.en} = ${v.primary}`;
  } else {
    miniResult.textContent = `${v.primary} = ${v.en}`;
  }

  // Luxus-Inhalt vorbereiten (aber noch versteckt)
  extraEl.innerHTML = buildExtra(v);
  setExtraVisible(false);
}

function toggleExtra(){
  const visible = extraEl.style.display === "block";
  setExtraVisible(!visible);
}

/* ===== Controls ===== */
function next(){
  idx++;
  if(idx >= VOCAB.length){
    idx = 0;
    score = 0;
    scoreEl.textContent = "Punkte: 0";
  }
  buildRound();
}

function restart(keepScore=false){
  idx = 0;
  if(!keepScore){
    score = 0;
    scoreEl.textContent = "Punkte: 0";
  }
  order = shuffle ? shuffledIndices(VOCAB.length) : Array.from({length:VOCAB.length}, (_,i)=>i);
  buildRound();
}

function toggleShuffle(){
  shuffle = !shuffle;
  shuffleBtn.textContent = "Reihenfolge: " + (shuffle ? "Zufall" : "Fix");
  restart(true);
}

/* init */
restart(false);
</script>
</body>
</html>

